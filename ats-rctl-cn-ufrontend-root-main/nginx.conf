#load_module modules/ngx_otel_module.so;
#user  nobody;

worker_processes 1;

# error_log  /var/log/nginx/error.log warn;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

pid /var/run/nginx.pid;


events {
    worker_connections 1024;
}


http {
    include mime.types;
    # include       /etc/nginx/conf.d/opentelemetry_module.conf;
    default_type application/octet-stream;

    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
    '$status $body_bytes_sent "$http_referer" '
    '"$http_user_agent" "$http_x_forwarded_for"';

    #access_log  logs/access.log  main;
    #access_log /var/log/nginx/access.log  main;
    # access_log /var/log/frontend/forms-frontends-service/forms.log  main;
    #error_log /var/log/nginx/error.log;

    sendfile on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout 30s;

    server_tokens off;

    gzip on;
    #otel_exporter {
    #    endpoint otel-collector-collector.opentelemetry:4317;
    #    interval    5s;
    #    batch_size  512;
    #    batch_count 4;
    #}
    
    # Desactivar encabezado Date
    proxy_hide_header Date;
    
    # HTTP Server
    server {
        listen 9000;
        server_name localhost;
        charset utf-8;
        
        # Asegúrate de que solo hay una directiva X-Frame-Options
        add_header X-Frame-Options "DENY";
        
        #access_log  logs/host.access.log  main;
        #return 301 https://$host$request_uri;
        location / {
            # proxy_pass http://ui-dev.joyit.io;
            root /usr/share/nginx/html;
            index index.html index.htm;
            try_files $uri /index.html;
            # rewrite ^/$ /landing permanent;
            #otel_trace         on;
            #otel_trace_context inject;
            if ($request_method = 'GET') {
                add_header 'Access-Control-Allow-Origin' '*';
                add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS'; 
                add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range'; 
                add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';
                #Sebas <
                # Bloquea completamente el enmarcado en iframes
                add_header X-Frame-Options "DENY";

                # Alternativamente, permite el enmarcado solo desde el mismo dominio
                add_header X-Frame-Options "SAMEORIGIN";
                add_header X-Content-Type-Options "nosniff";
                # Encabezados de seguridad
                add_header X-Content-Type-Options "nosniff" always;
                add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
                # Agregar encabezados de control de caché
                add_header Cache-Control "no-cache, no-store, must-revalidate, private";
                add_header Pragma "no-cache";
                add_header Expires "0";
                add_header Cache-Control "public, max-age=31536000, immutable";
                #Sebas >
            }

        }

        location /login {
            proxy_pass http://user-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
#         location / {
#         # Bloquea completamente el enmarcado en iframes
#             add_header X-Frame-Options "DENY" always;
#             add_header Content-Security-Policy "frame-ancestors 'none';" always;
#             # Eliminar encabezados de tiempo
#             add_header Date "";
#             add_header Last-Modified "";
#             add_header X-Content-Type-Options "nosniff";
#             # Encabezados de seguridad
#             add_header X-Content-Type-Options "nosniff" always;
#             add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;
#             # Agregar encabezados de control de caché
#             add_header Cache-Control "no-cache, no-store, must-revalidate, private";
#             add_header Pragma "no-cache";
#             add_header Expires "0";
#             add_header Cache-Control "public, max-age=31536000, immutable";

# # Personalizar página de error
# error_page 404 /custom_404.html;  # Crea una página de error personalizada


#         # Alternativamente, permite el enmarcado solo desde el mismo dominio
#         # add_header X-Frame-Options "SAMEORIGIN";
#         }
        location /landing {
            proxy_pass http://landing-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }

        location /recruitment/applicants/offers {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/offers/1?page=1 {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/dashboard {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/candidate/applications {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/candidate/applications/details {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/candidate/applications/calendarInterviews {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/candidate/favorites {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/candidate/myProfile {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/candidate/myProfile/myPortfolio {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/candidate/myProfile/cv {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/settings/cuenta {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/settings/notificaciones {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/settings/visibilidad {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/candidate/myEvaluations {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/faq {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/faq/ticket {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/faq/ticket/affairs {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/faq/ticket/update {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/faq/newfaq {
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }
        location /recruitment/applicants/notifications{
            proxy_pass http://recruitment-dev.joyit.io/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            alias /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ index.html =404;
        }



        #error_page  404              /404.html;
        # redirect server error pages to the static page /50x.html
        #
        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
            root html;
        }
    }


}